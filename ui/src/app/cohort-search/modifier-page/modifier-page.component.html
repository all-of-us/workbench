<form [formGroup]="form">
  <section class="form-block">
    <div class="modifier-header">
      The following modifiers are optional and apply to all selected criteria
    </div>
    <div *ngIf="preview.get('error')" class="alert alert-danger alert-sm">
      <div class="alert-items">
        <div class="alert-item static">
          <div class="alert-text">
            A problem occurred and we were not able to retrieve the requested data
          </div>
        </div>
      </div>
    </div>
    <app-validator-errors [form]="form"></app-validator-errors>
    <div *ngFor="let mod of modifiers; let i = index" [formGroupName]="mod.name">
      <div class="label-flex">
        <label class="modifier-event-header" [for]="mod.name">{{ mod.label }}</label>
        <ng-container *ngIf="mod.label === 'Shifted Event Date'">
          <small class="name"
                 [popper]="codesPopper"
                 [popperTrigger]="'hover'"
                 [popperPlacement]="'top'">
            <div class="label-info">
              <clr-icon  class="is-solid" shape="info-standard"></clr-icon>
            </div>
          </small>
          <popper-content #codesPopper>
            <p class="tooltip-text" [style.margin]="'0'">
              Dates are consistently shifted within a participantâ€™s record
              by a time period of up to 364 days backwards.
              The date shift differs across participants.</p>
          </popper-content>
        </ng-container>
      </div>
        <div class="modifier-container">
          <div class="dropdown-width ">
            <clr-dropdown >
              <button type="button" class="btn btn-outline" clrDropdownTrigger>
                <span>{{dropdownOption.selected[i]}}</span>
                <clr-icon shape="caret down"></clr-icon>
              </button>
              <clr-dropdown-menu [class.encounters]="mod.name === 'encounters'"  clrPosition="bottom-left" *clrIfOpen>
                <button
                  *ngFor="let opt of mod.operators"
                  [value]="opt.value"
                  (click)="selectChange(opt, i, $event, mod)"
                  class="dropdown-item"
                  type="button"
                  clrDropdownItem>
                  {{ opt.name}}
                  <span *ngIf="showCount(mod.name, opt.name)" class="badge badge-info">
                    {{ visitCounts[opt.value] | number }}
                  </span>
                </button>
              </clr-dropdown-menu>
            </clr-dropdown>
          </div>
          <ng-container *ngIf="dropdownOption.selected[i] !== 'Any'">
            <ng-container *ngIf="mod.inputType">
              <div>
                <input *ngIf="mod.inputType !== 'date'"
                  [min]="mod.min"
                  [max]="mod.max"
                  step="1"
                  class="modifier-event-indicator"
                  formControlName="valueA"
                  [type]="mod.inputType"
                  appIntegerValidator>
              </div>
              <div *ngIf="mod.inputType === 'date'">
                <input class="modifier-calender" type="text" placeholder="YYYY-MM-DD" (blur)="dateBlur(0)" formControlName="valueA">
                <input class="hidden-input" type="date" [formControl]="dateA" [(clrDate)]="dateObjs[0]">
              </div>
              <ng-container  *ngIf="dropdownOption.selected[i] === 'Between'">
                <div class="and-text">
                  <div>and</div>
                </div>
                <div>
                  <input *ngIf="mod.inputType !== 'date'"
                    [min]="mod.min"
                    [max]="mod.max"
                    step="1"
                    class="modifier-event-indicator"
                    formControlName="valueB"
                    [type]="mod.inputType"
                    appIntegerValidator>
                </div>
              </ng-container>
              <ng-container *ngIf="dropdownOption.selected[i] === 'Is Between'">
                <div class="and-text">
                  <div>and</div>
                </div>
                <div>
                  <input class="modifier-calender" type="text" placeholder="YYYY-MM-DD" (blur)="dateBlur(1)" formControlName="valueB">
                  <input class="hidden-input" type="date" [formControl]="dateB" [(clrDate)]="dateObjs[1]">
                </div>
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
    </div>
  </section>
</form>
<div class="container count-preview">
  <div class="row">
    <div class="col-lg-3">
      <button type="button"
        class="btn calculate-btn"
        [clrLoading]="preview.get('requesting')"
        (click)="requestPreview()"
        [disabled]="disableCalculate || !formChanges">
        Calculate
      </button>
    </div>
    <ng-container *ngIf="!preview.get('requesting')">
      <div class="col-lg-8 text-padding" *ngIf="preview.get('count') >= 0">
        <div class="result-text">
          Results
        </div>
        <div>
          Number Participants:
          <span class="text-bold" *ngIf="!preview.get('requesting')">
         {{ preview.get('count', 0) | number }}
        </span>
        </div>
      </div>
    </ng-container>
  </div>
</div>
