<form [formGroup]="form">
  <section class="form-block">
    <div class="modifier-header">
      The Following Modifiers are Optional
    </div>
    <div *ngFor="let mod of modifiers; let i = index" [formGroupName]="mod.name">
      <div class="label-flex">
        <label class="modifier-event-header" [for]="mod.name">{{ mod.label }}</label>
        <ng-container *ngIf = "mod.label === 'Shifted Event Date'">
          <small class="name"
                 [popper]="codesPopper"
                 [popperTrigger]="'hover'"
                 [popperPlacement]="'top'">
            <clr-icon  class="label-info is-solid" shape="info-standard"></clr-icon>
          </small>
          <popper-content #codesPopper>
            <p class="tooltip-text" [style.margin]="'0'">
              Dates are consistently shifted within a participantâ€™s record
              by a time period of up to 364 days backwards.
              The date shift differs across participants.</p>
          </popper-content>
        </ng-container>
      </div>
        <div class="modifier-container">
          <div class="dropdown-width ">
            <clr-dropdown >
              <button type="button" class="btn btn-outline" clrDropdownTrigger>
                <span>{{dropdownOption.selected[i]}}</span>
                <clr-icon shape="caret down"></clr-icon>
              </button>
              <clr-dropdown-menu  clrPosition="bottom-left" *clrIfOpen>
                <button
                  *ngFor="let opt of mod.operators"
                  [value]="opt.value"
                  (click)="selectChange(opt, i, $event, mod)"
                  class="dropdown-item"
                  type="button"
                  clrDropdownItem>
                  {{ opt.name}}
                  <span *ngIf="showCount(mod.name, opt.name)" class="badge badge-info">
                    {{ visitCounts[opt.value] | number }}
                  </span>
                </button>
              </clr-dropdown-menu>
            </clr-dropdown>
          </div>
          <ng-container *ngIf="dropdownOption.selected[i] !== 'Any'">
            <ng-container *ngIf="mod.inputType">
              <div>
                <input *ngIf="mod.inputType !== 'date'" class="modifier-event-indicator" formControlName="valueA" [type]="mod.inputType">
              </div>
              <div *ngIf="mod.inputType === 'date'" >
                <input class="modifier-calender" [ngModel]="myDate | date:'yyyy-MM-dd'"
                       (ngModelChange)="myDate = $event" formControlName="valueA" placeholder="YYYY-MM-DD" [type]="mod.inputType" type="date" clrDate>
              </div>
              <ng-container  *ngIf="dropdownOption.selected[i] === 'Between'">
                <div class="and-text">
                  <div>and</div>
                </div>
                <div>
                  <input *ngIf="mod.inputType !== 'date'"  class="modifier-event-indicator" formControlName="valueB" [type]="mod.inputType">
                </div>
              </ng-container>
              <ng-container *ngIf="dropdownOption.selected[i] === 'Is Between'">
                <div class="and-text" >
                  <div>and</div>
                </div>
                <div>
                  <input *ngIf = "mod.inputType === 'date'" [ngModel]="selectedDate | date:'yyyy-MM-dd'"
                         (ngModelChange)="selectedDate = $event"  class="modifier-calender" formControlName="valueB" placeholder="YYYY-MM-DD" [type]="mod.inputType" type="date" clrDate>
                </div>
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
    </div>
  </section>
</form>
<div class="container count-preview">
  <div class="row">
    <div class="col-lg-2 ">
      <button type="button" [ngClass]="[ preview.get('requesting')? 'greyed-button': 'calculate-btn']"
        class="btn "
        [clrLoading]="preview.get('requesting')"
        (click)="requestPreview()"
        [disabled] = "!formChanges">
        Calculate
      </button>
    </div>
    <ng-container *ngIf="!preview.get('requesting')" >
      <div class="col-lg-8 text-padding" *ngIf="preview.get('count') >= 0">
        <div class="result-text">
          Results
        </div>
        <div>
          Number Participants:
          <span class="text-bold" *ngIf="!preview.get('requesting')">
         {{ preview.get('count', 0) | number }}
        </span>
        </div>
      </div>
    </ng-container>
  </div>
</div>
